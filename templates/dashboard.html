{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white">My Resumes & CVs</h2>
    <div class="btn-group">
        <a href="{% url 'create_resume' %}?type=resume" class="btn btn-light">
            <i class="bi bi-file-earmark-person"></i> Build New Resume
        </a>
        <a href="{% url 'create_resume' %}?type=cv" class="btn btn-outline-light">
            <i class="bi bi-file-earmark-text"></i> Build New CV
        </a>
    </div>
</div>

<div class="row">
    {% for resume in resumes %}
        <div class="col-md-4 mb-4">
            <div class="glass-card p-4 h-100 d-flex flex-column justify-content-between">
                <div>
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h4 class="mb-0">{{ resume.title }}</h4>
                        <span class="badge {% if resume.doc_type == 'cv' %}bg-info{% else %}bg-secondary{% endif %} text-dark">
                            {{ resume.get_doc_type_display }}
                        </span>
                    </div>
                    <span class="badge bg-primary mb-3">{{ resume.get_template_name_display }} Template</span>
                    <p class="text-muted small">Created: {{ resume.created_at|date:"M d, Y" }}</p>
                </div>
                <div class="d-grid gap-2 mt-3">
                    <div class="btn-group">
                        <a href="{% url 'view_resume' resume.pk %}" class="btn btn-outline-primary" target="_blank">View</a>
                        <button type="button" class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                            <span>Download</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'export_resume' resume.pk %}?format=pdf"><i class="bi bi-file-earmark-pdf me-2"></i>Download PDF</a></li>
                            <li><a class="dropdown-item" href="{% url 'export_resume' resume.pk %}?format=doc"><i class="bi bi-file-word me-2"></i>Download Word (.doc)</a></li>
                            <li><a class="dropdown-item" href="{% url 'export_resume' resume.pk %}?format=txt"><i class="bi bi-file-text me-2"></i>Download Text (.txt)</a></li>
                        </ul>
                    </div>
                    <a href="{% url 'edit_resume' resume.pk %}" class="btn btn-primary text-white">Edit</a>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12 text-center text-white py-5">
            <h3>No documents found.</h3>
            <p>Start building your professional success today.</p>
            <div class="mt-3">
                <a href="{% url 'create_resume' %}?type=resume" class="btn btn-primary btn-lg me-2">Create First Resume</a>
                <a href="{% url 'create_resume' %}?type=cv" class="btn btn-info btn-lg text-white">Create First CV</a>
            </div>
        </div>
    {% endfor %}
</div>

<script>
    function printResume(e, url) {
        e.preventDefault();
        const win = window.open(url, '_blank');
        win.onload = function() {
            setTimeout(function() {
                win.print();
            }, 1000);
        };
    }
</script>
{% endblock %}
