{% extends 'base.html' %}

{% block content %}
<div class="row mb-5">
    <div class="col-12 text-center">
        <h2 class="display-4 fw-bold text-white mb-3" style="text-shadow: 0 2px 10px rgba(0,0,0,0.2);">Template Gallery</h2>
        <p class="lead text-white-50">Explore our collection of professionally designed templates.</p>
    </div>
</div>

<ul class="nav nav-pills justify-content-center mb-5" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active bg-white text-primary" id="pills-all-tab" data-bs-toggle="pill" data-bs-target="#pills-all" type="button">All Templates</button>
    </li>
</ul>

<div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-all">
        <div class="row g-4">
            {% for code, name in templates %}
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="glass-card h-100 p-0 overflow-hidden position-relative template-card" style="transition: transform 0.3s;">
                    <!-- Iframe Preview (Scaled Down) -->
                    <div class="ratio ratio-1x1 bg-white border-bottom">
                         <iframe src="{% url 'demo_template' code %}" style="width: 200%; height: 200%; transform: scale(0.5); transform-origin: 0 0; border: none; pointer-events: none;" scrolling="no"></iframe>
                         <!-- Overlay for interaction -->
                         <a href="#" class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center text-decoration-none preview-overlay" data-bs-toggle="modal" data-bs-target="#previewModal" data-template-code="{{ code }}" data-template-name="{{ name }}" style="background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s;">
                            <span class="btn btn-light rounded-pill px-4 fw-bold"><i class="bi bi-eye me-2"></i>Preview</span>
                         </a>
                    </div>
                    <div class="p-3 text-center">
                        <h5 class="fw-bold mb-1">{{ name }}</h5>
                        <p class="text-muted small mb-0 font-monospace">{{ code }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content bg-light">
            <div class="modal-header border-0 shadow-sm bg-white">
                <h5 class="modal-title fw-bold"><i class="bi bi-palette me-2"></i> <span id="modalTemplateName">Template</span> Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0 d-flex justify-content-center bg-secondary bg-opacity-10">
                <div class="shadow-lg my-4 bg-white" style="width: 210mm; min-height: 297mm;">
                    <iframe id="modalPreviewFrame" src="" style="width: 100%; height: 100%; min-height: 297mm; border: none;"></iframe>
                </div>
            </div>
            <div class="modal-footer border-0 bg-white justify-content-center">
                <a href="{% url 'create_resume' %}?type=resume" class="btn btn-primary btn-lg rounded-pill px-5"><i class="bi bi-pencil-square me-2"></i>Use This Template</a>
            </div>
        </div>
    </div>
</div>

<style>
    .template-card:hover { transform: translateY(-5px); }
    .template-card:hover .preview-overlay { opacity: 1 !important; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var previewModal = document.getElementById('previewModal');
        previewModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var code = button.getAttribute('data-template-code');
            var name = button.getAttribute('data-template-name');
            var modalTitle = previewModal.querySelector('#modalTemplateName');
            var iframe = previewModal.querySelector('#modalPreviewFrame');
            
            modalTitle.textContent = name;
            iframe.src = '/templates/demo/' + code + '/';
        });
    });
</script>
{% endblock %}
